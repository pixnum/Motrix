<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Motrix</title>
<style>
body {
  font-family: Arial, sans-serif;
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
  margin: 0;
  background: #111;
  color: #fff;
}
.app-frame {
  border: 2px solid #444;
  border-radius: 20px;
  padding: 20px;
  text-align: center;
  background: #1c1c1c;
  box-shadow: 0 0 20px rgba(0,0,0,0.7);
  width: 350px;
}
h2 { margin: 0 0 15px; color: #0ff; }
.controls { margin-bottom: 15px; display: flex; flex-wrap: wrap; justify-content: center; gap: 5px; }
select, button, input[type="color"] {
  margin: 5px;
  padding: 6px 12px;
  border-radius: 8px;
  border: none;
  font-size: 14px;
  cursor: pointer;
}
canvas { background: #000; border-radius: 50%; display: block; margin: 10px auto; }
.digital {
  font-size: 48px;
  font-weight: bold;
  color: #0ff;
  text-shadow: 0 0 6px #0ff;
  display: none;
  transition: text-shadow 0.3s ease-in-out;
}
footer { margin-top: 12px; font-size: 12px; color: #aaa; }
</style>
</head>
<body>
<div class="app-frame">
  <h2>Motrix</h2>
  <div class="controls">
    <select id="mode">
      <option value="car">Car</option>
      <option value="train">Train</option>
      <option value="bike">Bike</option>
      <option value="aeroplane">Aeroplane</option>
      <option value="ship">Ship</option>
      <option value="human">Human</option>
    </select>
    <button onclick="toggleMode()">Toggle Analogue/Digital</button>
    <button onclick="startTracking()">Start</button>
    <button onclick="stopTracking()">Stop</button>
    <select id="glow">
      <option value="low">Low Glow</option>
      <option value="medium" selected>Medium Glow</option>
      <option value="high">High Glow</option>
    </select>
    <label for="glowColor">Glow Color: </label>
    <input type="color" id="glowColor" value="#00ffff">
  </div>
  <canvas id="dial" width="280" height="280"></canvas>
  <div id="digital" class="digital">0</div>
  <p id="status">Waiting for GPS...</p>
  <footer>Â© Manik Roy 2025 | All Rights Reserved.</footer>
</div>

<script>
const canvas = document.getElementById("dial");
const ctx = canvas.getContext("2d");
const digitalDisplay = document.getElementById("digital");
const statusText = document.getElementById("status");
const modeSelect = document.getElementById("mode");
const glowSelect = document.getElementById("glow");
const glowColorPicker = document.getElementById("glowColor");

let analogue = true, watchId = null, lastCoords = null, currentSpeed = 0, smoothSpeed = 0;
let currentGlow = "0 0 6px #0ff", glowColor = "#00ffff";

const vehicleModes = { car:180, train:300, bike:80, aeroplane:900, ship:50, human:25 };

function getStepSize(maxSpeed){
  if(maxSpeed<=30) return 5;
  if(maxSpeed<=100) return 10;
  if(maxSpeed<=200) return 20;
  if(maxSpeed<=400) return 50;
  return 200;
}
function getFontSize(maxSpeed){
  if(maxSpeed<=50) return 16;
  if(maxSpeed<=200) return 14;
  if(maxSpeed<=400) return 12;
  return 10;
}

function drawDial(speed, maxSpeed){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  const radius = canvas.width/2-20;
  ctx.save();
  ctx.translate(canvas.width/2,canvas.height/2);

  // dial circle
  ctx.beginPath();
  ctx.arc(0,0,radius,0,Math.PI*2);
  ctx.strokeStyle = glowColor;
  ctx.shadowColor = glowColor;
  ctx.shadowBlur = parseInt(currentGlow.match(/\d+/)[0]);
  ctx.lineWidth = 3;
  ctx.stroke();

  // numerals
  const step = getStepSize(maxSpeed);
  const fontSize = getFontSize(maxSpeed);
  ctx.fillStyle = "#fff";
  ctx.font = `${fontSize}px Arial`;
  ctx.shadowColor = glowColor;
  ctx.shadowBlur = parseInt(currentGlow.match(/\d+/)[0]);

  for(let i=0;i<=maxSpeed;i+=step){
    const angle = (Math.PI*(i/maxSpeed))-Math.PI/2;
    const x = Math.cos(angle)*(radius-25);
    const y = Math.sin(angle)*(radius-25);
    ctx.fillText(i.toString(),x-10,y+5);
  }

  // needle
  const needleAngle = (Math.PI*(speed/maxSpeed))-Math.PI/2;
  ctx.beginPath();
  ctx.moveTo(0,0);
  ctx.lineTo(Math.cos(needleAngle)*(radius-30),Math.sin(needleAngle)*(radius-30));
  ctx.strokeStyle = glowColor; // needle matches glow
  ctx.lineWidth = 4;
  ctx.shadowColor = glowColor;
  ctx.shadowBlur = parseInt(currentGlow.match(/\d+/)[0]);
  ctx.stroke();

  ctx.restore();
}

function toggleMode(){
  analogue = !analogue;
  canvas.style.display = analogue ? "block":"none";
  digitalDisplay.style.display = analogue ? "none":"block";
}

glowSelect.addEventListener("change",()=>{
  if(glowSelect.value==="low") currentGlow="0 0 2px #0ff";
  else if(glowSelect.value==="medium") currentGlow="0 0 6px #0ff";
  else currentGlow="0 0 12px #0ff";
  digitalDisplay.style.textShadow = currentGlow.replace(/#0ff/g,glowColor);
});
glowColorPicker.addEventListener("input",()=>{
  glowColor=glowColorPicker.value;
  digitalDisplay.style.textShadow=currentGlow.replace(/#0ff/g,glowColor);
});

function startTracking(){
  if(watchId) return;
  if(navigator.geolocation){
    statusText.textContent="Tracking speed...";
    watchId=navigator.geolocation.watchPosition(updateSpeed,handleError,{
      enableHighAccuracy:true, maximumAge:1000, timeout:5000
    });
  } else statusText.textContent="Geolocation not supported.";
}

function stopTracking(){
  if(watchId){
    navigator.geolocation.clearWatch(watchId);
    watchId=null;
    lastCoords=null;
    statusText.textContent="GPS tracking stopped.";
  }
}

function updateSpeed(position){
  const coords = position.coords;
  const maxSpeed = vehicleModes[modeSelect.value];
  let speedKmh = 0;

  if(coords.speed!=null) speedKmh=coords.speed*3.6;
  else if(lastCoords){
    const dist=haversine(lastCoords.latitude,lastCoords.longitude,coords.latitude,coords.longitude);
    const dt=(position.timestamp-lastCoords.timestamp)/1000;
    if(dt>0) speedKmh=(dist/dt)*3.6;
  }
  lastCoords={latitude:coords.latitude,longitude:coords.longitude,timestamp:position.timestamp};
  speedKmh=Math.min(speedKmh,maxSpeed);
  currentSpeed=speedKmh;
  smoothSpeed+= (currentSpeed-smoothSpeed)*0.2;

  if(analogue) drawDial(smoothSpeed,maxSpeed);
  else digitalDisplay.textContent=Math.round(smoothSpeed);
}

function handleError(err){ statusText.textContent="Error accessing GPS."; }

function haversine(lat1,lon1,lat2,lon2){
  function toRad(x){return x*Math.PI/180;}
  const R=6371000;
  const dLat=toRad(lat2-lat1);
  const dLon=toRad(lon2-lon1);
  const a=Math.sin(dLat/2)**2 + Math.cos(toRad(lat1))*Math.cos(toRad(lat2))*Math.sin(dLon/2)**2;
  const c=2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));
  return R*c;
}

// Initial draw
drawDial(0, vehicleModes.car);
</script>
</body>
</html>
